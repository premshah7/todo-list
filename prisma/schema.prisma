generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Projects {
  ProjectID   Int         @id @default(autoincrement())
  ProjectName String
  Description String?
  CreatedBy   Int
  Status      String      @default("Active")
  CreatedAt   DateTime    @default(now())
  Users       Users       @relation(fields: [CreatedBy], references: [UserID], onDelete: Cascade)
  TaskLists   TaskLists[]
}

model Roles {
  RoleID    Int         @id @default(autoincrement())
  RoleName  String      @unique
  UserRoles UserRoles[]
}

model TaskComments {
  CommentID   Int      @id @default(autoincrement())
  TaskID      Int
  UserID      Int
  CommentText String
  CreatedAt   DateTime @default(now())
  Tasks       Tasks    @relation(fields: [TaskID], references: [TaskID], onDelete: Cascade)
  Users       Users    @relation(fields: [UserID], references: [UserID], onDelete: Cascade)
}

model TaskHistory {
  HistoryID  Int      @id @default(autoincrement())
  TaskID     Int
  ChangedBy  Int
  ChangeType String
  ChangeTime DateTime @default(now())
  NewValue   String?
  OldValue   String?
  Users      Users    @relation(fields: [ChangedBy], references: [UserID], onDelete: Cascade)
  Tasks      Tasks    @relation(fields: [TaskID], references: [TaskID], onDelete: Cascade)
}

model TaskLists {
  ListID    Int      @id @default(autoincrement())
  ProjectID Int
  ListName  String
  Projects  Projects @relation(fields: [ProjectID], references: [ProjectID], onDelete: Cascade)
  Tasks     Tasks[]
}

model Tasks {
  TaskID       Int            @id @default(autoincrement())
  ListID       Int
  AssignedTo   Int?
  Title        String
  Description  String?
  Priority     String
  Status       String
  DueDate      DateTime?
  Estimation   String?
  CreatedAt    DateTime       @default(now())
  Position     Int            @default(0)
  TaskComments TaskComments[]
  TaskHistory  TaskHistory[]
  Users        Users?         @relation(fields: [AssignedTo], references: [UserID])
  TaskLists    TaskLists      @relation(fields: [ListID], references: [ListID], onDelete: Cascade)
}

model UserRoles {
  UserRoleID Int   @id @default(autoincrement())
  UserID     Int
  RoleID     Int
  Roles      Roles @relation(fields: [RoleID], references: [RoleID], onDelete: Cascade)
  Users      Users @relation(fields: [UserID], references: [UserID], onDelete: Cascade)
}

model Users {
  UserID           Int            @id @default(autoincrement())
  UserName         String         @unique
  Email            String         @unique
  PasswordHash     String
  ResetToken       String?
  ResetTokenExpiry DateTime?
  CreatedAt        DateTime       @default(now())
  Projects         Projects[]
  TaskComments     TaskComments[]
  TaskHistory      TaskHistory[]
  Tasks            Tasks[]
  UserRoles        UserRoles[]
}
